//
//  NSDictionary+ManOpenTests.m
//  ManOpenTests
//
//  Created by Don McCaughey on 12/25/17.
//

#import <XCTest/XCTest.h>
#import "NSDictionary+ManOpen.h"


@interface NSDictionary_ManOpenTests : XCTestCase
@end


@implementation NSDictionary_ManOpenTests

- (void)testDictionaryWithURLQuery_for_nil
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:nil];
    XCTAssertNil(dictionary);
}

- (void)testDictionaryWithURLQuery_for_empty_string
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@""];
    XCTAssertEqualObjects(@{}, dictionary);
}

- (void)testDictionaryWithURLQuery_for_key_only
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"foo"];
    XCTAssertEqualObjects(@{ @"foo": @"" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_key_and_equals_only
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"foo="];
    XCTAssertEqualObjects(@{ @"foo": @"" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_value_only
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"=bar"];
    XCTAssertEqualObjects(@{ @"": @"bar" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_equals_only
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"="];
    XCTAssertEqualObjects(@{ @"": @"" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_one_key
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"foo=bar"];
    XCTAssertEqualObjects(@{ @"foo": @"bar" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_url_encoded_key_and_value
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"2%2b2%3D5=odds%20%26%20ends"];
    XCTAssertEqualObjects(@{ @"2+2=5": @"odds & ends" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_invalid_url_encoded_key_and_value
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"%foo=%bar"];
    XCTAssertEqualObjects(@{ @"%foo": @"%bar" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_two_keys
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"foo=bar&color=red"];
    NSDictionary *expected = @{
                               @"foo": @"bar",
                               @"color": @"red",
                               };
    XCTAssertEqualObjects(expected, dictionary);
}

- (void)testDictionaryWithURLQuery_for_duplicate_key
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"foo=bar&foo=BAR"];
    XCTAssertEqualObjects(@{ @"foo": @"BAR" }, dictionary);
}

- (void)testDictionaryWithURLQuery_for_two_keys_with_whitespace
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"\tfoo =%20bar &\tcolor%20= red\n"];
    NSDictionary *expected = @{ @"foo": @"bar", @"color": @"red" };
    XCTAssertEqualObjects(expected, dictionary);
}

- (void)testDictionaryWithURLQuery_with_internal_whitespace
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"status=foo\tbar&color=red%0agreen&cool flavor=mint"];
    NSDictionary *expected = @{ @"status": @"foo\tbar", @"color": @"red\ngreen", @"cool flavor": @"mint" };
    XCTAssertEqualObjects(expected, dictionary);
}

- (void)testDictionaryWithURLQuery_for_manopen_scheme
{
    NSDictionary *dictionary = [NSDictionary dictionaryWithURLQuery:@"background=true&MANPATH=/usr/share/man%3a/usr/local/share/man"];
    NSDictionary *expected = @{ @"background": @"true", @"MANPATH": @"/usr/share/man:/usr/local/share/man" };
    XCTAssertEqualObjects(expected, dictionary);
}

@end
